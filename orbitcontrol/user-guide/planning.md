# 任务计划管理

## 任务 Mission

### 任务列表

点击 `菜单` -> `任务` 会如下显示 `任务列表面板`：

![](/images/orbitcontrol/user-guide/planning-panel-missions.png)

- 可根据任务名称、任务标签、任务类型进行筛选
- 任务卡片中显示简要信息，包括：
  - 任务类型（使用不同图标表示，![](/icons/waypoints.svg) 表示路径任务，![](/icons/diamond.svg) 表示网格任务）
  - 任务名称
  - 预计完成时长
  - 航点数
  - 所属站点

### 新建任务

#### 1. 以手动添加航点的方式新建任务

点击 `任务列表面板` 中的 ![](/icons/plus.svg) 按钮，弹出 `任务新建面板`：

![](/images/orbitcontrol/user-guide/planning-panel-mission-edit.gif)

- 填写任务名称
- 任务标签 ( Tag )
- 选择站点
- 配置航线参数和航点参数

:::tabs
== 航线参数

航线参数是指整个任务期间的公共参数，包括：

1. 巡航速度，任务执行期间设备的运行速度
2. 云台控制
   - 设置为 `使用航点设置` 表示不设公共参数，使用各航点的个性化参数
   - 设置具体的云台角度，表示任务期间始终保持同个角度
3. 结束后动作
   - 返回 `Home`
   - 返回充电点并充电
   - 原地待命

== 航点参数

航点参数是指每个具体航点的相关配置，主要包括航点位置和到达航点后的动作配置。

1. 取航点位置，有两种方式
   - 点击 ![](/icons/plus.svg) 按钮，然后在地图上选择
   - 点击 ![](/icons/map-pin-plus.svg) 按钮，获取设备当前位置（与 `手动控制` 配合使用，可避免手动地图取点造成的误差）
2. 取点后，配置执行动作，在实际任务执行中，动作在到达航点后触发，支持的动作包括：
   | 设备 | 动作 | 说明 |
   | --- | -- | -- |
   | 车辆 | 设置停留时长 | 配置：时长|
   | | 执行充电操作 | |
   | 云台 | 设置云台角度 | 配置：Pitch、Yaw|
   | 相机 | 变焦 | 配置：焦距 |
   | | 开始抓拍 | 配置：间隔、张数 |
   | | 开始录像 | 配置：时长 |

:::

#### 2. 以录制方式新建任务

用户按照预设的任务目标，实际操作，平台根据用户操作，记录过程中的航点、设备/载荷的行为动作，自动生成任务配置。

录制方式的优势在于，可以根据实际场景，更好地还原任务过程，例如：在仪表检查任务中，人为很难确定云台的精确角度，通过录制的方式更容易操作。

如下图，点击录制按钮，开始录制，任务结束后，再次点击停止录制：

![](/images/orbitcontrol/user-guide/planning-action-mission-record.png)

停止后，系统自动生成任务，并跳转到任务编辑页面，用户补充任务名称、按需编辑其他参数，点击保存，即可完成任务设置。

## 调度 Scheduled

根据时间和时间周期，配置任务自动化执行策略。

主页面如下图所示：

![](/images/orbitcontrol/user-guide/planning-panel-schedule.png)

1. 时间导航：快速定位到 `今天`，前后翻页，日期选择器等
2. 调度配置按钮，点击后打开新建窗口，填写任务名称、选择执行设备和任务、选择开始时间/重复周期/结束时间等（**快捷方式**：点击日历中的窗格，自动获取当前窗格对应的日期时间作为开始时间，继续编辑同样可以完成调度配置）

![](/images/orbitcontrol/user-guide/planning-dialog-schedule-new.png)

3. 日历视图切换
4. 颜色标签：用来表示不同的调度阶段，在日历窗格中，已竖线的样式进行展示，快速区分各任务的执行情况。

## 自动化流程 Flows

自动化流程是 OrbitControl 中的一项动态功能，旨在通过配置，使设备可以对特定告警进行响应，执行预定动作（可在人工审核后执行，也可自动执行），从而提升作业效率。

系统还支持通过电子邮件或短信通知，便于组织内指定成员及时掌握无人机的运行动态，显著提升在应急响应、安全巡检及基础设施监控等领域的响应效率，降低了反应时间和对人工干预的依赖。

// TODO 原型待补充

### 触发条件 Trigger

包括告警、通知、传感器数据条件等

### 响应模式 Response Mode

- 手动，弹出提示，等待人工确认
- 自动

### 动作 Action

可配置到动作包括有：

1. 同 `任务 Mission`，参考：任务配置中的 `航点参数`
2. 系统通知
   - 邮件
   - 短信

支持配置动作序列，按顺序执行。

### 与 Failsafe 的区别

Failsafe（故障保护） 是一种安全机制，用于在关键异常发生时自动执行预设动作，以避免设备损毁或造成安全事故。

与自动化流程在概念上会有一定的相似性，所以特说明如下：

| 功能机制         | Failsafe（故障保护）         | Flows（自动化流程）          |
| ---------------- | ---------------------------- | ---------------------------- |
| **定位**         | 设备级安全策略               | 流程级事件驱动任务           |
| **配置位置**     | 设备设置菜单中               | Planning → Flows             |
| **触发方式**     | 异常触发（紧急、中断）       | 条件触发（事件/告警）        |
| **执行行为**     | 自动应急响应（如返航、降落） | 执行组合任务（如报警、调度） |
| **是否依赖对方** | 自主，不依赖 Flows           | 可调用，但非必须             |
