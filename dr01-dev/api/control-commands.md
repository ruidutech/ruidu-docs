# 控制相关功能

## 功能说明
控制管理

## 简要描述
控制功能

## 接口版本
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2022-10-11 | 2022-10-11 |

## 接口列表
- [控制机器人移动](#控制机器人移动)
- [软件急停](#软件急停)
- [获取软件急停状态](#获取软件急停状态)
- [控制云台向指定方向移动](#控制云台向指定方向移动)
- [控制云台移动至指定位置](#控制云台移动至指定位置)
- [获取云台状态](#获取云台状态)
- [灯光控制](#灯光控制)
- [获取灯光状态](#获取灯光状态)
- [外设开关](#外设开关)
- [获取开关状态](#获取开关状态)
- [控制顶升](#控制顶升)
- [LED控制](#led控制)
- [LED字段获取](#led字段获取)
- [清洁设备控制](#清洁设备控制)

## 接口详情

### 控制机器人移动

**简要描述:**
控制机器人移动,该接口需要以不低于3hz左右频率保持发送,当未发送时机器人会停止移动

**接口版本:**
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2020-4-23 | 2020-4-23 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/move`

**请求方式:**
- GET
- POST

**请求参数:** 无

**请求发送json:**
```json
{
  "speed": {
    "linearSpeed": 0.2,
    "angularSpeed": 0
  }
}
```

**参数说明:**
- linearSpeed: 前为正，后为负单位m/s
- angularSpeed: 右转为正，左转为负，单位弧度/s

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": "",
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 软件急停

**简要描述:**
发送速度0控制车辆停止可能由于减速度无法及时停止，可以通过发送brake命令强制抱死急停

**接口版本:**
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2020-8-24 | 2020-8-24 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/move_brake`

**请求方式:**
- GET
- POST

**请求参数:** 无

**请求发送json:**
```json
{
  "brake": true
}
```

**参数说明:**
- brake: true为开，打开软件急停后发送控制无效

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": "",
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 获取软件急停状态

**简要描述:**
检查当前软件急停开关是否开启

**接口版本:**
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2020-8-24 | 2020-8-24 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/get_move_brake`

**请求方式:**
- GET
- POST

**请求参数:**
无

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": {
    "brake_state": false
  },
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |
| brake_state | bool | 软件急停状态 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 控制云台向指定方向移动

**简要描述:**
控制机器人向指定方向移动

**接口版本:**
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2020-4-23 | 2020-4-23 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/ptz_direction_move`

**请求方式:**
- GET
- POST

**请求参数:** 无

**请求发送json:**
```json
{
  "direction": {
    "direction": 0,
    "speed": 0
  }
}
```

**参数说明:**
| 参数名 | 是否必须 | 类型 | 说明 |
|:-------|:--------:|:----:|:-----|
| direction | 是 | int | 0:(停止移动),1:(向上);2:(向下);3:(向左);4(向右);5(雨刷开关,speed为0时关,其他值为开);6(灯光开关,speed为2是关,为1是开);7(热成像开关,speed0为关,1为开,已废弃);8(云台缩放，speed为0时，停止缩放，speed为1时放大，2时为缩小，其他值不操作) |
| speed | 是 | int | 当控制云台移动时,选择移动速度,取值范围0~64,其他时候为控制开关,0为关,1为开,当为缩放大小时，0为停止缩放，1为放大，2为缩小 |

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": "",
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 控制云台移动至指定位置

**简要描述:**
控制云台移动至指定角度与雨刷器开关

**接口版本:**
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2020-4-23 | 2020-4-23 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/ptz_location_move`

**请求方式:**
- GET
- POST

**请求参数:** 无

**请求发送json:**
```json
{
  "location": {
    "yaw": 0,
    "pitch": 0
  }
}
```

**参数说明:**
- yaw: 偏航角
- pitch: 俯仰角

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": "",
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 获取云台状态

**简要描述:**
获取云台状态数据

**接口版本:**
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2020-5-6 | 2020-5-6 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/sensor_data/ptz_state`

**请求方式:**
- GET
- POST

**请求参数:**
无

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": {
    "light": 2,
    "yaw": 0,
    "wiper": false,
    "pitch": 0
  },
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |
| yaw | int | 偏航角 |
| pitch | int | 俯仰角 |
| wiper | bool | 雨刷状态 |
| light | int | 云台灯光状态:1打开,2关闭 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 灯光控制

**简要描述:**
控制车辆灯光开关

**接口版本:**
| 版本号 | 制定日期 | 修订日期 | 修改内容 |
|:-------|:--------:|:--------:|:---------|
| 1.0.0  | 2020-5-6 | 2020-5-6 | 初次提交 |
| 1.0.0  | 2020-5-6 | 2020-8-18 | 增加LockLight用于开锁 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/light_control`

**请求方式:**
- GET
- POST

**请求参数:** 无

**请求发送json:**
```json
{
  "light_switch": {
    "High_light": false,
    "Low_light": false,
    "Warning_light": false,
    "UV_light": false,
    "Lock_light": false
  }
}
```

**参数说明:**
| 参数名 | 是否必须 | 类型 | 说明 |
|:-------|:--------:|:----:|:-----|
| High_light | 是 | bool | 远光灯开关 |
| Low_light | 是 | bool | 近光灯开关，当远近光灯同时为true时，会只开启近光灯 |
| Warning_light | 是 | bool | 警示灯开关 |
| UV_light | 是 | bool | 紫外灯开关(用于DR910消毒机器人) |
| Lock_light | 是 | bool | 锁开关/底部灯开关(特殊开关接口) |

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": "",
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 获取灯光状态

**简要描述:**
获取车辆灯光开关

**接口版本:**
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2020-5-6 | 2020-5-6 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/sensor_data/light_state`

**请求方式:**
- GET
- POST

**请求参数:**
无

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": {
    "light_switch": {
      "Low_light": false,
      "High_light": false,
      "Warning_light": false,
      "UV_light": false
    }
  },
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |
| High_light | bool | 远光灯开关 |
| Low_light | bool | 近光灯开关 |
| Warning_light | bool | 警示灯开关 |
| UV_light | bool | 紫外灯开关(用于消毒机器人) |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 外设开关

**简要描述:**
控制底板外设开关

**接口版本:**
| 版本号 | 制定日期 | 修订日期 | 修改内容 |
|:-------|:--------:|:--------:|:---------|
| 1.0.0  | 2020-5-6 | 2020-8-21 | 初次提交 |
| 1.0.1  | 2020-5-6 | 2021-11-30 | 修复实例json的错误 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/switch_control`

**请求方式:**
- GET
- POST

**请求参数:** 无

**请求发送json:**
```json
{
  "switchs": [
    {
      "switch_bit": 0, // 开关设置位数
      "value": true // 开关值
    },
    {
      "switch_bit": 1, // 备用
      "value": false
    },
    {
      "switch_bit": 2, // ⾼⾳喇叭
      "value": true
    },
    {
      "switch_bit": 3, // ⽹枪开关
      "value": true
    }
  ]
}
```

**参数说明:**
| 参数名 | 是否必须 | 类型 | 说明 |
|:-------|:--------:|:----:|:-----|
| switch_bit | 是 | int | 开关设置位数 |
| value | 是 | bool | 开关值 |

- 如果数据中多次对同一个位置进行设置，则会按照数据顺序设置开关值
- 允许只发送指定位的开关状态

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": "",
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 获取开关状态

**简要描述:**
获取控制底板外设开关状态

**接口版本:**
| 版本号 | 制定日期 | 修订日期 | 修改内容 |
|:-------|:--------:|:--------:|:---------|
| 1.0.0  | 2020-5-6 | 2020-8-21 | 初次提交 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/sensor_data/switch_state`

**请求方式:**
- GET
- POST

**请求参数:** 无

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": {
    "switchs": {
      "switch_bit_0": true,
      "switch_bit_1": true,
      "switch_bit_2": true
    }
  },
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 控制顶升

**简要描述:**
控制机器人顶升

**接口版本:**
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2021-10-18 | 2021-10-18 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/lift_ctrl?lift_state=`

**请求方式:**
- GET

**请求参数:**
| 参数名 | 是否必须 | 类型 | 说明 |
|:-------|:--------:|:----:|:-----|
| lift_state | 是 | int | 需获取的机器人的顶升状态：0=下降;1=上升 |

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": "",
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "STATUS NOT MATCHED",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### led控制

**简要描述:**
发送字段控制LED

**接口版本:**
| 版本号 | 制定日期 | 修订日期 | 修改内容 |
|:-------|:--------:|:--------:|:---------|
| 1.0.0  | 2020-10-19 | 2020-10-19 | 初次提交 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/show_led_text`

**请求方式:**
- GET
- POST

**请求参数:** 无

**请求发送json:**
```json
{
  "color": 0,
  "text": "testtest"
}
```

**参数说明:**
| 参数名 | 是否必须 | 类型 | 说明 |
|:-------|:--------:|:----:|:-----|
| color | 是 | int | 颜色设置,1为红色,2为绿色,3为黄色 |
| text | 是 | string | 显示字段,最多显示8个字符,中文占2个字符 |

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": "",
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### laser_tf校正

**简要描述:**
矫正激光tf的外部接口

**接口版本:**
| 版本号 | 制定日期 | 修订日期 | 修改说明 |
|:-------|:--------:|:--------:|:---------|
| 1.0.0  | 2022-06-08 | 2022-06-08 | 初次创建 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/calibrate_scan`

**请求方式:**
- GET

**请求参数:**
| 参数名 | 是否必须 | 类型 | 说明 |
|:-------|:--------:|:----:|:-----|
| scan_id | 是 | string | 需要修改的scan_tf的ID号，一般为2d激光["laser01", "laser02", "laser03", ....] |
| x_offset | 是 | float | 矫正激光x方向的偏移量，即需要往前移动多少，单位:m |
| y_offset | 是 | float | 矫正激光y方向的偏移量，即需要往前移动多少，单位:m |
| yaw_offset | 是 | float | 矫正激光x方向的偏移量，即需要往前移动多少，单位:弧度 |

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": {
    "calibrated_tf": [0.1, 0.0, 0.5, 0.0, 0.0, 0.0]
  },
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 103,
  "msg": "not recived msg:no laser03 frame exist",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### led字段获取

**简要描述:**
获取当前led显示接口

**接口版本:**
| 版本号 | 制定日期 | 修订日期 | 修改内容 |
|:-------|:--------:|:--------:|:---------|
| 1.0.0  | 2020-10-19 | 2020-10-19 | 初次提交 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/get_led_text`

**请求方式:**
- GET
- POST

**请求参数:** 无

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": {
    "color": 0,
    "text": "testtest"
  },
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
记录着最后发送的字段,开机程序启动前有一段时间系统启动,led会显示为默认字符
更多返回错误代码请看首页的错误代码描述

### lslidar_ch32校准

**简要描述:**
矫正激光tf的外部接口

**接口版本:**
| 版本号 | 制定日期 | 修订日期 | 修改说明 |
|:-------|:--------:|:--------:|:---------|
| 1.0.0  | 2023-02-07 | 2023-02-07 | 初次创建 |

**状态限制:** 无

**状态跳转至:** 无

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/calibrate_lslidar32`

**请求方式:**
- GET

**请求参数:**
| 参数名 | 是否必须 | 类型 | 说明 |
|:-------|:--------:|:----:|:-----|
| scan_id | 是 | string | 需要修改的scan_tf的ID号，一般为2d激光["laser01", "laser02", "laser03", ....] |
| x_offset | 是 | float | 矫正激光x方向的偏移量，即需要往前移动多少，单位:m |
| y_offset | 是 | float | 矫正激光y方向的偏移量，即需要往前移动多少，单位:m |
| yaw_offset | 是 | float | 矫正激光x方向的偏移量，即需要往前移动多少，单位:弧度 |

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": {
    "calibrated_tf": [0.1, 0.0, 0.5, 0.0, 0.0, 0.0]
  },
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 103,
  "msg": "not recived msg:no laser03 frame exist",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述

### 清洁设备控制

**简要描述:**
只适用于洗地机器人类型，控制扫地刷盘和喷水开关

**接口版本:**
| 版本号 | 制定日期 | 修订日期 |
|:-------|:--------:|:--------:|
| 1.0.0  | 2023-2-27 | 2023-2-27 |

**请求URL:** 
- `http://机器人IP:端口号/robot/cmd/clean_devices_control`

**请求方式:**
- POST

**请求发送json:**
```json
{
  "sweep_switch": true,
  "watering_switch": false
}
```

**参数说明:**
- 以下bool类型建议用小写
- sweep_switch: 扫地刷盘开关，true为打开，false为关闭
- watering_switch: 喷水开关，true为打开，false为关闭

**返回示例:**

正确时返回:
```json
{
  "errorCode": "",
  "msg": "successed",
  "data": "",
  "successed": true
}
```

错误时返回:
```json
{
  "errorCode": 100,
  "msg": "",
  "data": "",
  "successed": false
}
```

**返回参数说明:**
| 参数名 | 类型 | 说明 |
|:-------|:-----|:-----|
| errorCode | int | 错误代码 |

**备注:**
更多返回错误代码请看首页的错误代码描述